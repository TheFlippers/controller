#include "text/read_txt.h"

char font[95][7] =    {{0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, //
					   {0b00011100, 0b00011100, 0b00111000, 0b00110000, 0b00100000, 0b00000000, 0b01000000}, // !
					   {0b01101100, 0b01101100, 0b00100100, 0b01001000, 0b00000000, 0b00000000, 0b00000000}, // "
					   {0b00000000, 0b00101000, 0b01111100, 0b00101000, 0b01111100, 0b00101000, 0b00000000}, // #
					   {0b00010000, 0b01111100, 0b11100000, 0b01111100, 0b00001110, 0b01111100, 0b00010000}, // $
					   {0b11000010, 0b11000100, 0b00001000, 0b00010000, 0b00100000, 0b01000110, 0b10000110}, // %
					   {0b00100000, 0b01010000, 0b01010000, 0b00100000, 0b11010100, 0b11001000, 0b01110110}, // &
					   {0b00011000, 0b00011000, 0b00001000, 0b00010000, 0b00000000, 0b00000000, 0b00000000}, // '
					   {0b00011000, 0b00110000, 0b00110000, 0b00110000, 0b00110000, 0b00110000, 0b00011000}, // (
					   {0b00011000, 0b00001100, 0b00001100, 0b00001100, 0b00001100, 0b00001100, 0b00011000}, // )
					   {0b00010000, 0b01010100, 0b00111000, 0b11111110, 0b00111000, 0b01010100, 0b00010000}, // *
					   {0b00000000, 0b00110000, 0b00110000, 0b11111100, 0b00110000, 0b00110000, 0b00000000}, // +
					   {0b00000000, 0b00000000, 0b00000000, 0b00011000, 0b00011000, 0b00001000, 0b00010000}, // ,
					   {0b00000000, 0b00000000, 0b00000000, 0b01111100, 0b00000000, 0b00000000, 0b00000000}, // -
					   {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00011000, 0b00011000}, // .
					   {0b10000000, 0b01000000, 0b00100000, 0b00010000, 0b00001000, 0b00000100, 0b00000010}, // /
					   {0b00111000, 0b01001100, 0b11000110, 0b11000110, 0b11000110, 0b01100100, 0b00111000}, // 0
					   {0b00011000, 0b00111000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b01111110}, // 1
					   {0b01111100, 0b11000110, 0b00001110, 0b00111100, 0b01111000, 0b11100000, 0b11111110}, // 2
					   {0b01111110, 0b00001100, 0b00011000, 0b00111100, 0b00000110, 0b11000110, 0b01111100}, // 3
					   {0b00011100, 0b00111100, 0b01101100, 0b11001100, 0b11111110, 0b00001100, 0b00001100}, // 4
					   {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // 5
					   {0b11111100, 0b11000000, 0b11111100, 0b00000110, 0b00000110, 0b11000110, 0b01111100}, // 6
					   {0b11111110, 0b11000110, 0b00001100, 0b00011000, 0b00110000, 0b00110000, 0b00110000}, // 7
					   {0b01111000, 0b11000100, 0b11100100, 0b01111000, 0b10011110, 0b10000110, 0b01111100}, // 8
					   {0b01111100, 0b11000110, 0b11000110, 0b01111110, 0b00000110, 0b00001100, 0b01111000}, // 9
					   {0b00000000, 0b00011000, 0b00011000, 0b00000000, 0b00011000, 0b00011000, 0b00000000}, // :
					   {0b00011000, 0b00011000, 0b00000000, 0b00011000, 0b00011000, 0b00001000, 0b00010000}, // ;
					   {0b00001100, 0b00011000, 0b00110000, 0b01100000, 0b00110000, 0b00011000, 0b00001100}, // <
					   {0b00000000, 0b00000000, 0b01111110, 0b00000000, 0b01111110, 0b00000000, 0b00000000}, // =
					   {0b01100000, 0b00110000, 0b00011000, 0b00001100, 0b00011000, 0b00110000, 0b01100000}, // >
					   {0b01111100, 0b11000110, 0b00001110, 0b00011000, 0b00010000, 0b00000000, 0b00010000}, // ?
					   {0b01111100, 0b11000110, 0b11011110, 0b11010110, 0b11011100, 0b11000000, 0b01111100}, // @
					   {0b00111000, 0b01101100, 0b11000110, 0b11000110, 0b11111110, 0b11000110, 0b11000110}, // A
					   {0b11111100, 0b11000110, 0b11000110, 0b11111100, 0b11000110, 0b11000110, 0b11111100}, // B
					   {0b00111100, 0b01100110, 0b11000000, 0b11000000, 0b11000000, 0b01100110, 0b00111100}, // C
					   {0b11111000, 0b11001100, 0b11000110, 0b11000110, 0b11000110, 0b11001100, 0b11111000}, // D
					   {0b11111110, 0b11000000, 0b11000000, 0b11111100, 0b11000000, 0b11000000, 0b11111110}, // E
					   {0b11111110, 0b11000000, 0b11000000, 0b11111100, 0b11000000, 0b11000000, 0b11000000}, // F
					   {0b00111110, 0b01100000, 0b11000000, 0b11001110, 0b11000110, 0b01100110, 0b00111110}, // G
					   {0b11000110, 0b11000110, 0b11000110, 0b11111110, 0b11000110, 0b11000110, 0b11000110}, // H
					   {0b01111110, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b01111110}, // I
					   {0b00000110, 0b00000110, 0b00000110, 0b00000110, 0b00000110, 0b11000110, 0b01111100}, // J
					   {0b11000110, 0b11001100, 0b11011000, 0b11110000, 0b11111000, 0b11011100, 0b11001110}, // K
					   {0b11000000, 0b11000000, 0b11000000, 0b11000000, 0b11000000, 0b11000000, 0b11111110}, // L
					   {0b11000110, 0b11101110, 0b11111110, 0b11111110, 0b11010110, 0b11000110, 0b11000110}, // M
					   {0b11000110, 0b11100110, 0b11110110, 0b11111110, 0b11011110, 0b11001110, 0b11000110}, // N
					   {0b01111100, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b01111100}, // O
					   {0b11111100, 0b11000110, 0b11000110, 0b11000110, 0b11111100, 0b11000000, 0b11000000}, // P
					   {0b01111100, 0b11000110, 0b11000110, 0b11000110, 0b11011110, 0b11001100, 0b01111010}, // Q
					   {0b11111100, 0b11000110, 0b11000110, 0b11001110, 0b11111000, 0b11011100, 0b11001110}, // R
					   {0b01111000, 0b11001100, 0b11000000, 0b01111100, 0b00000110, 0b11000110, 0b01111100}, // S
					   {0b01111110, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000}, // T
					   {0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b01111100}, // U
					   {0b11000110, 0b11000110, 0b11000110, 0b11101110, 0b01111100, 0b00111000, 0b00010000}, // V
					   {0b11000110, 0b11000110, 0b11010110, 0b11111110, 0b11111110, 0b11101110, 0b11000110}, // W
					   {0b11000110, 0b11101110, 0b01111100, 0b00111000, 0b01111100, 0b11101110, 0b11000110}, // X
					   {0b01100110, 0b01100110, 0b01100110, 0b00111100, 0b00011000, 0b00011000, 0b00011000}, // Y
					   {0b11111110, 0b00001110, 0b00011100, 0b00111000, 0b01110000, 0b11100000, 0b11111110}, // Z
					   {0b00111100, 0b00110000, 0b00110000, 0b00110000, 0b00110000, 0b00110000, 0b00111100}, // [
					   {0b10000000, 0b01000000, 0b00100000, 0b00010000, 0b00001000, 0b00000100, 0b00000010}, // backslash
					   {0b00111100, 0b00001100, 0b00001100, 0b00001100, 0b00001100, 0b00001100, 0b00111100}, // ]
					   {0b00010000, 0b00111000, 0b01101100, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ^
					   {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111110}, // _
					   {0b00110000, 0b00011000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // `
					   {0b00000000, 0b00000000, 0b01111100, 0b00000110, 0b01111110, 0b11000110, 0b01111110}, // a
					   {0b11000000, 0b11000000, 0b11111100, 0b11000110, 0b11000110, 0b11000110, 0b11111100}, // b
					   {0b00000000, 0b00000000, 0b01111110, 0b11000000, 0b11000000, 0b11000000, 0b01111110}, // c
					   {0b00000110, 0b00000110, 0b01111110, 0b11000110, 0b11000110, 0b11000110, 0b01111110}, // d
					   {0b00000000, 0b00000000, 0b01111100, 0b11000110, 0b11111110, 0b11000000, 0b01111110}, // e
					   {0b00011110, 0b00110000, 0b11111110, 0b00110000, 0b00110000, 0b00110000, 0b00110000}, // f
					   {0b00000000, 0b00000000, 0b01111110, 0b11000110, 0b01111110, 0b00000110, 0b11111100}, // g
					   {0b11000000, 0b11000000, 0b11111100, 0b11000110, 0b11000110, 0b11000110, 0b11000110}, // h
					   {0b00011000, 0b00000000, 0b00111000, 0b00011000, 0b00011000, 0b00011000, 0b01111110}, // i
					   {0b00000110, 0b00000000, 0b00000110, 0b00000110, 0b00000110, 0b11000110, 0b01111100}, // j
					   {0b11000000, 0b11000000, 0b11000110, 0b11001100, 0b11111000, 0b11001100, 0b11000110}, // k
					   {0b00111000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b01111110}, // l
					   {0b00000000, 0b00000000, 0b11111100, 0b11010110, 0b11010110, 0b11010110, 0b11010110}, // m
					   {0b00000000, 0b00000000, 0b11111100, 0b11000110, 0b11000110, 0b11000110, 0b11000110}, // n
					   {0b00000000, 0b00000000, 0b01111100, 0b11000110, 0b11000110, 0b11000110, 0b01111100}, // o
					   {0b00000000, 0b00000000, 0b11111100, 0b11000110, 0b11111100, 0b11000000, 0b11000000}, // p
					   {0b00000000, 0b00000000, 0b01111110, 0b11000110, 0b01111110, 0b00001100, 0b00000110}, // q
					   {0b00000000, 0b00000000, 0b11011110, 0b11110000, 0b11000000, 0b11000000, 0b11000000}, // r
					   {0b00000000, 0b00000000, 0b01111110, 0b11000000, 0b01111100, 0b00000110, 0b11111100}, // s
					   {0b01100000, 0b01100000, 0b11110000, 0b01100000, 0b01100000, 0b01100110, 0b00111100}, // t
					   {0b00000000, 0b00000000, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b01111110}, // u
					   {0b00000000, 0b00000000, 0b11000110, 0b11000110, 0b01101100, 0b00111000, 0b00010000}, // v
					   {0b00000000, 0b00000000, 0b11000110, 0b11010110, 0b11010110, 0b11010110, 0b01111110}, // w
					   {0b00000000, 0b00000000, 0b11000110, 0b01101100, 0b00111000, 0b01101100, 0b11000110}, // x
					   {0b00000000, 0b00000000, 0b11000110, 0b11000110, 0b01111110, 0b00000110, 0b11111100}, // y
					   {0b00000000, 0b00000000, 0b11111110, 0b00001100, 0b00111000, 0b01100000, 0b11111110}, // z
					   {0b00001100, 0b00011000, 0b00011000, 0b00110000, 0b00011000, 0b00011000, 0b00001100}, // {
					   {0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000}, // |
					   {0b00110000, 0b00011000, 0b00011000, 0b00001100, 0b00011000, 0b00011000, 0b00110000}, // }
					   {0b00000000, 0b00000000, 0b00110010, 0b01001100, 0b00000000, 0b00000000, 0b00000000}, // ~
};

char* ReadTXTFile(char* filename) {

	FILE* fp = NULL;
	char* buf = NULL;
	long numBytes = 0;
	 
	// Open an existing file for reading
	fp = fopen(filename, "r");
	if(fp == NULL) {
		fprintf(stderr, "ERROR: Could not open file for reading: %s\n!\n", filename);
		return NULL;
	}
	 
	// Find length of file
	fseek(fp, 0L, SEEK_END);
	numBytes = ftell(fp);
	fseek(fp, 0L, SEEK_SET);	
	
	// Create buffer of correct length
	buf = malloc(numBytes * sizeof(*buf));	
	if(buf == NULL) {
		fprintf(stderr, "ERROR: Could not allocate memory!\n");
		fclose(fp);
		return NULL;
	}

	// Copy data to buffer
	fread(buf, sizeof(*buf), numBytes, fp);
	fclose(fp);

	return buf;
}

int TextToPixels(char* text, Message* msg) {

	// Allocate space for pixels
	msg->len = strlen(text);
	msg->letters = malloc(sizeof(*(msg->letters)) * msg->len);
	if (msg->letters == NULL) {
		fprintf(stderr, "ERROR: Could not allocate memory!\n");
		return 1;
	}

	// Copy letters of message from the font
	for (int i = 0; i < msg->len; i++) {
		if (text[i] < FONT_OFFSET) {
			msg->letters[i].character = ' ';
			memcpy(msg->letters[i].pixels, font[0], CHAR_HEIGHT);
		}
		else {
			msg->letters[i].character = text[i];
			memcpy(msg->letters[i].pixels, font[text[i] - FONT_OFFSET], CHAR_HEIGHT);
		}
	}
	
	return 0;
}

void FreeMessage(Message* msg) {
	
	free(msg->letters);
}

